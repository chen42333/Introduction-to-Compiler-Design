# hw5 report

|||
|-:|:-|
|Name|陳芷萱|
|ID|110550029|

## How much time did you spend on this project

About 10 hours.

## Project overview
Added member variables of ```CodeGenerator``` (since if statements and loops can be nested, some information will stored in a stack):
- ```in_func``` (bool, default = ```false```): If the current position is in a function. It will be set to true in program node before visit its function nodes children. This variable determines whether the declared variables or constants are global (not in a function) or local (in a function). Also, if  a compound statement node finds this variable is false, that means its the body of program node and represent the main function, and it will set the corresponding frame pointer and return address, and then set this variable to ```true```.
- ```var_addr``` (int, default = ```8```): The current local variable position below the frame pointer. Since there has been already two variables (frame pointer and return address), the default value of this variable is ```8```. Each time a new local variable/constant is set, this variable will increment by four and this value will be stored in the symbol table entry of the new variable/constant. This variable will be set to the default value at the beginning in every function node.
- ```var_lhs``` (bool, default = ```false```): If it is dealing with the variable at the left hand side of an assignment operator or in the ```read``` function. This variable determines whether we should push the address or the value of the variable on the stack.
- ```tag``` (int, default = ```1```): The next available label. This variable will increment by two in if statement without else body, and will increment by three in if statement with else body, while loop and for loop (the condition part of a loop needs a new label).
- ```cur_tag``` (int, , default = ```0```): The label of the current section. The value will change once a new label generated.
- ```tags``` (stack of pointers of int, default = ```empty```): The new labels that will be generated by the current if statement or while/for loop. Each element is an array with three elements. If the last element is ```-1```, it means the current position is in an if statement without else body; if it is ```-2```, it means the current position is in a while or for loop; otherwise, the current position is in an if statement with else body, and the second element will be set to -1 before entering the else body, and thus whether the current position is in the if body or else body can be specified.
- ```condition``` (bool, default = ```false```): If the current position is in the condition part of if or while statement. The binary operators about comparison will generate branch instructions and change the current label to the first value of the array on the top of ```tags```.
- ```body``` (bool, default = ```false```): If the compound statement is the body of an if statement or a loop. If its value is ```true```, the compound statement has to generate new label and maybe a jump instruction (required for an if statement with else body and a loop) at the end.
- ```loop_cond_tag``` (stack of int, default = ```empty```): The label of the condition part of a loop. The loop body has to jump to the condition part at the end to see whether it should leave the loop.
- ```for_cond_setting``` (bool, default = ```false```): If the current node has to generate some instructions for the setting of the for loop, such as incrementing the loop variable, comparing the value of the loop variable to the end condition. 
- ```loop_var_addr``` (stack of int, default = ```empty```): The address of the loop variable of a for loop below the frame pointer. Store the loop variables address in advance and then it can be more convenient to increment the loop variable at the end of the loop body.

All of these variables (except stack type variables) about control will be backed up and set to the default value before visiting children. After visiting children, the actions will be determined by the backup.

If the number of arguments of a function exceeds eight, the remained arguments will be passed by the stack. Since all of the arguments will be prepared and pushed on the top of the stack and popped before calling a function under the stack machine model, the frame pointer of the new frame will be 8 bytes below the stack pointer after popping the argument to the registers. So we can directly move the remained arguments below by 8 bytes, and only have to store the address to its symbol table entries when initializing the function arguments.

## What is the hardest you think in this project

I think the hardest part is how to set and jump to the correct labels.

## Feedback to T.A.s

I think the tutorial is roughly clear, but we still have to think a lot of implementation details.
And this assignment is not easy but also not too hard for me. It takes some time but is not so hard as hw3 or hw4.
